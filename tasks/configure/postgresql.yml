---
- name: Create postgresql.conf file
  template:
    src: "postgresql.conf.j2"
    dest: "{{ pgsql_config_file }}"
    owner: postgres
    group: postgres
    mode: 0644
  become: true
  tags:
    - role_install
    - role_configure

- name: Create postgresql.conf.d files
  template:
    src: "postgresql.conf.d/{{ item }}.j2"
    dest: "{{ pgsql_config_directory }}/conf.d/{{ item }}"
    owner: postgres
    group: postgres
    mode: 0644
  become: true
  with_items:
    - "autovacuum.conf"
    - "client_connection_defaults.conf"
    - "connections_authentication.conf"
    - "customized_options.conf"
    - "error_handling.conf"
    - "files_locations.conf"
    - "lock_management.conf"
    - "process_title.conf"
    - "query_tuning.conf"
    - "replication.conf"
    - "reporting_logging.conf"
    - "resource_usage.conf"
    - "statistics.conf"
    - "version_platform_compatibility.conf"
    - "wal.conf"
  tags:
    - role_install
    - role_configure